<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Marketing Management Team Dashboard</title>

  <!-- Libraries -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
  />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body {
      background-color: #f5f7fb;
      font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont,
        "Helvetica Neue", sans-serif;
    }

    header {
      background: linear-gradient(90deg, #0d6efd, #007bff);
      color: white;
      text-align: center;
      padding: 2rem 0 1.2rem;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
    }

    header h1 {
      font-weight: 700;
      font-size: 2rem;
      margin-bottom: 0.3rem;
    }

    header p {
      margin: 0;
      opacity: 0.9;
    }

    .metric-card {
      border: none;
      border-radius: 18px;
      background: white;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .metric-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }

    .metric-card h3 {
      font-size: 2rem;
      color: #0d6efd;
      margin-bottom: 0.3rem;
    }

    select#monthFilter {
      margin: 20px auto 10px;
      display: block;
      width: 260px;
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid #ced4da;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
    }

    .table-wrapper {
      margin-top: 1.5rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    }

    th,
    td {
      padding: 12px;
      text-align: center;
      vertical-align: middle;
      font-size: 0.95rem;
    }

    th {
      background-color: #0d6efd;
      color: white;
      font-weight: 600;
    }

    tr:nth-child(even) {
      background-color: #f8f9ff;
    }

    tr:hover {
      background-color: #eef4ff;
    }

    td.text-primary.fw-semibold {
      color: #0d6efd;
      cursor: pointer;
      text-decoration: underline;
      transition: color 0.15s ease;
    }

    td.text-primary.fw-semibold:hover {
      color: #084fc4;
    }

    .chart-container {
      background: white;
      border-radius: 15px;
      padding: 1rem 1.5rem 1.5rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      margin-top: 2rem;
    }

    #backButton {
      display: none;
      margin: 1rem auto 0.5rem;
      padding: 9px 22px;
      background-color: #0d6efd;
      color: white;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    #backButton:hover {
      background-color: #084fc4;
    }

    /* Profile card for individual view */
    #profileCard {
      display: none;
      margin-top: 1.5rem;
    }

    .profile-card-inner {
      display: flex;
      align-items: center;
      gap: 1rem;
      border-radius: 16px;
      background: white;
      padding: 1rem 1.3rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    }

    .avatar-circle {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: #0d6efd;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.4rem;
      flex-shrink: 0;
    }

    .profile-details h4 {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 700;
    }

    .profile-details small {
      color: #6c757d;
    }

    .profile-stats {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-left: auto;
      font-size: 0.9rem;
    }

    .profile-stat-pill {
      background: #f1f4ff;
      border-radius: 999px;
      padding: 4px 10px;
      color: #0d6efd;
      font-weight: 600;
    }

    footer {
      text-align: center;
      padding: 1.5rem 0 1rem;
      color: #6c757d;
      font-size: 0.85rem;
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>Marketing Management Team Dashboard</h1>
    <p>Performance Analytics ‚Äî July to November 2025</p>
  </header>

  <div class="container my-3 pb-4">
    <label class="fw-bold text-center d-block mt-2"
      >üìÖ Select Month:</label
    >
    <select id="monthFilter">
      <option value="All">All</option>
    </select>

    <!-- KPI Cards -->
    <div class="row g-4 mt-2">
      <div class="col-md-3 col-12">
        <div class="metric-card p-4 text-center">
          <h3 id="totalHours">0h</h3>
          <p class="mb-0">Total Hours</p>
        </div>
      </div>
      <div class="col-md-3 col-12">
        <div class="metric-card p-4 text-center">
          <h3 id="avgPerf">0%</h3>
          <p class="mb-0">Average Performance</p>
        </div>
      </div>
      <div class="col-md-3 col-12">
        <div class="metric-card p-4 text-center">
          <h3 id="teamCount">0</h3>
          <p class="mb-0">Team Members</p>
        </div>
      </div>
      <div class="col-md-3 col-12">
        <div class="metric-card p-4 text-center">
          <h3 id="topPerformer">-</h3>
          <p class="mb-0">Top Performer</p>
        </div>
      </div>
    </div>

    <!-- Team Table -->
    <div class="table-wrapper table-responsive">
      <table id="teamTable" class="mt-4">
        <thead>
          <tr>
            <th>Name</th>
            <th>Hours</th>
            <th>Performance (%)</th>
            <th>Remarks</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Back button + Individual profile -->
    <button id="backButton">‚Üê Back to Team Overview</button>

    <div id="profileCard">
      <div class="profile-card-inner">
        <div class="avatar-circle" id="avatarCircle">S</div>
        <div class="profile-details">
          <h4 id="profileName">Name</h4>
          <small id="profileMonth">Month: -</small><br />
          <small id="profileRemarks">Remarks: -</small>
        </div>
        <div class="profile-stats">
          <div class="profile-stat-pill" id="profileHours">0 h</div>
          <div class="profile-stat-pill" id="profilePerf">0 %</div>
        </div>
      </div>
    </div>

    <!-- Chart -->
    <div class="chart-container">
      <canvas id="mainChart" height="120"></canvas>
    </div>
  </div>

  <footer>
    ¬© 2025 Marketing Team Dashboard ‚Äî Interactive Insights
  </footer>

  <script>
    let allData = [];
    let perfKey = "Performance"; // will auto-detect
    let chartInstance = null;
    let currentMonth = "All";

    // Initialise: load CSV
    Papa.parse("team_report.csv", {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: function (results) {
        // Clean headers and values
        allData = results.data.map((r) => {
          const clean = {};
          for (let k in r) {
            if (!k) continue;
            clean[k.trim()] = (r[k] || "").toString().trim();
          }
          return clean;
        });

        if (!allData.length) return;

        // Detect performance column (any header that starts with "perform")
        const firstRow = allData[0];
        const keys = Object.keys(firstRow);
        const foundPerf =
          keys.find((k) => k.toLowerCase().startsWith("perform")) ||
          "Performance";
        perfKey = foundPerf;

        populateMonths(allData);
        updateDashboard("All");

        document
          .getElementById("monthFilter")
          .addEventListener("change", (e) => {
            currentMonth = e.target.value;
            hideIndividualView();
            updateDashboard(currentMonth);
          });
      },
    });

    function populateMonths(data) {
      const select = document.getElementById("monthFilter");
      const months = [
        ...new Set(
          data
            .map((d) => (d.Month || "").trim())
            .filter((v) => v && v.toLowerCase() !== "month")
        ),
      ];
      months.forEach((m) => {
        const opt = document.createElement("option");
        opt.value = m;
        opt.textContent = m;
        select.appendChild(opt);
      });
    }

    function updateDashboard(month) {
      const filtered =
        month === "All"
          ? allData
          : allData.filter((r) => (r.Month || "").trim() === month);

      if (!filtered.length) return;

      // Compute KPIs
      const totalHours = filtered.reduce(
        (sum, r) => sum + (parseFloat(r.Hours) || 0),
        0
      );
      const avgPerf =
        filtered.reduce(
          (sum, r) => sum + (parseFloat(r[perfKey]) || 0),
          0
        ) / filtered.length;

      const top = filtered.reduce((a, b) =>
        (parseFloat(a[perfKey]) || 0) > (parseFloat(b[perfKey]) || 0) ? a : b
      );

      document.getElementById("totalHours").innerText =
        totalHours.toFixed(1) + " h";
      document.getElementById("avgPerf").innerText =
        isNaN(avgPerf) || !isFinite(avgPerf)
          ? "0%"
          : avgPerf.toFixed(1) + " %";
      document.getElementById("teamCount").innerText = filtered.length;
      const topName = top?.Name || "-";
      const topPerf = top ? parseFloat(top[perfKey]) || 0 : 0;
      document.getElementById("topPerformer").innerText =
        topName === "-" ? "-" : `${topName} ‚Äî ${topPerf}%`;

      renderTable(filtered);
      renderTeamChart(filtered);
    }

    function renderTable(data) {
      const tbody = document.querySelector("#teamTable tbody");
      tbody.innerHTML = "";

      data.forEach((row) => {
        const tr = document.createElement("tr");
        const perfVal = parseFloat(row[perfKey]) || 0;

        tr.innerHTML = `
          <td class="text-primary fw-semibold">${row.Name}</td>
          <td>${row.Hours || 0}</td>
          <td>${perfVal}</td>
          <td>${row.Remarks || "Nil"}</td>
        `;

        // Click on name => individual view
        tr
          .querySelector("td.text-primary")
          .addEventListener("click", () => showIndividualReport(row));

        tbody.appendChild(tr);
      });
    }

    function renderTeamChart(data) {
      const ctx = document.getElementById("mainChart").getContext("2d");
      const labels = data.map((r) => r.Name);
      const hours = data.map((r) => parseFloat(r.Hours) || 0);
      const perfs = data.map((r) => parseFloat(r[perfKey]) || 0);

      if (chartInstance) chartInstance.destroy();

      chartInstance = new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [
            {
              type: "bar",
              label: "Hours",
              data: hours,
              backgroundColor: "#0d6efd",
              yAxisID: "y1",
            },
            {
              type: "line",
              label: "Performance %",
              data: perfs,
              borderColor: "#ffc107",
              backgroundColor: "#ffc107",
              yAxisID: "y2",
              borderWidth: 3,
              tension: 0.3,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: "bottom" },
            title: {
              display: true,
              text: "Team Overview ‚Äî Hours & Performance",
            },
          },
          scales: {
            y1: {
              beginAtZero: true,
              position: "left",
              title: { display: true, text: "Hours" },
            },
            y2: {
              beginAtZero: true,
              position: "right",
              grid: { drawOnChartArea: false },
              title: { display: true, text: "Performance %" },
            },
          },
        },
      });
    }

    function showIndividualReport(row) {
      // Show profile card
      document.getElementById("backButton").style.display = "inline-block";
      const profileCard = document.getElementById("profileCard");
      profileCard.style.display = "block";

      const name = row.Name || "-";
      const initials = name.trim()[0] || "?";
      const hours = parseFloat(row.Hours) || 0;
      const perf = parseFloat(row[perfKey]) || 0;
      const month = row.Month || currentMonth || "-";
      const remarks = row.Remarks || "Nil";

      document.getElementById("avatarCircle").innerText = initials;
      document.getElementById("profileName").innerText = name;
      document.getElementById("profileMonth").innerText = "Month: " + month;
      document.getElementById("profileRemarks").innerText =
        "Remarks: " + remarks;
      document.getElementById("profileHours").innerText =
        hours.toFixed(1) + " h";
      document.getElementById("profilePerf").innerText = perf + " %";

      renderIndividualChart(name, hours, perf);
    }

    function renderIndividualChart(name, hours, perf) {
      const ctx = document.getElementById("mainChart").getContext("2d");
      if (chartInstance) chartInstance.destroy();

      chartInstance = new Chart(ctx, {
        type: "bar",
        data: {
          labels: ["Hours", "Performance %"],
          datasets: [
            {
              type: "bar",
              label: "Hours",
              data: [hours, null],
              backgroundColor: "#0d6efd",
              yAxisID: "y1",
            },
            {
              type: "line",
              label: "Performance %",
              data: [null, perf],
              borderColor: "#ffc107",
              backgroundColor: "#ffc107",
              borderWidth: 3,
              tension: 0.3,
              yAxisID: "y2",
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: "bottom" },
            title: {
              display: true,
              text: name + " ‚Äî Individual Report",
            },
          },
          scales: {
            y1: {
              beginAtZero: true,
              position: "left",
              title: { display: true, text: "Hours" },
            },
            y2: {
              beginAtZero: true,
              position: "right",
              grid: { drawOnChartArea: false },
              title: { display: true, text: "Performance %" },
            },
          },
        },
      });
    }

    function hideIndividualView() {
      document.getElementById("backButton").style.display = "none";
      document.getElementById("profileCard").style.display = "none";
    }

    // Back button handler
    document.getElementById("backButton").addEventListener("click", () => {
      hideIndividualView();
      updateDashboard(currentMonth);
    });
  </script>
</body>
</html>
